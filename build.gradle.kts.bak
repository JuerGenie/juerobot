import com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar
import org.jetbrains.kotlin.gradle.tasks.KotlinCompile

plugins {
    id("org.jetbrains.kotlin.jvm") version "1.3.50"
    id("com.github.johnrengelman.shadow") version "5.0.0"
    maven
}

apply {
    plugin("maven")
    plugin("maven-publish")
}
group = "cn.juerwhang"
version = "alpha.1.0"
val localMavenRepo = "file://${File(System.getProperty("user.home"), ".m2/repository").absolutePath}"
val ktor = "1.2.5"

repositories {
    mavenCentral()
    mavenLocal()
    jcenter()
    maven("https://jitpack.io")
}

dependencies {
    implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")
    implementation("com.github.hydevelop:PicqBotX:4.12.0.991.PRE")

    implementation("me.liuwj.ktorm:ktorm-core:2.6")
    implementation("me.liuwj.ktorm:ktorm-support-sqlite:2.6")
    implementation("org.xerial:sqlite-jdbc:3.28.0")

    implementation("io.ktor:ktor-http:${ktor}")
    implementation("io.ktor:ktor-server-core:${ktor}")
    implementation("io.ktor:ktor-server-netty:${ktor}")
    implementation("io.ktor:ktor-websockets:${ktor}")
}

tasks.withType<KotlinCompile> {
    kotlinOptions.jvmTarget = "9"
}

tasks {
    named<ShadowJar>("shadowJar") {
        mergeServiceFiles()
    }
}

tasks {
    build {
        dependsOn(shadowJar)
    }
}

tasks.withType<Upload> {
    repositories {
        mavenLocal()
    }
}

//uploadArchives {
//    repositories {
//        mavenDeployer {
//            repository(url: localMavenRepo)
//
//            //构造项目的Pom文件
//            pom.project {
//                name = project.name
//                packaging = 'jar'
//            }
//        }
//    }
//}
